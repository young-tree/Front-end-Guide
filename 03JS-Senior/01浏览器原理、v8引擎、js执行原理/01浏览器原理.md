### 0.编程语言发展历史

- 第一阶段：机器语言（0101）一些机器指令
- 第二阶段：汇编语言（mov、ax、bx）一些汇编指令
- 第三阶段：高级语言（C、C++、Java、JavaScript、Python）
  - C、C++、Java编译型语言：将代码编译成可执行文件
  - JavaScript、Python解释性语言：边读边进行解释，再做执行

### 1.用户访问百度网站

- 用户在浏览器输入：https://www.baidu.com
- https://www.baidu.com经过dns服务器进行域名解析，解析成服务器的公网ip地址

### 2.访问

- 当我们访问百度的IP地址后，其实就是在访问它服务器中的一个index.html文件（下载此文件）
- 遇到css（link标签）就下载相应的css文件，遇到js（script标签）就下载相应的js文件

![image-20220105144442247](https://s2.loli.net/2022/02/09/E5qRA9jBXWOY7ge.png)

### 3.解析

- 我们下载了这些东西之后，总得解析它们才能看吧，谁去解析它们呢？
  - 浏览器内核

### 4.浏览器内核

- Gecko：被早期的Netscape（网景公司）和Mozilla Firefox浏览器使用； 
- Trident：微软开发，被IE4~IE11浏览器使用，但是Edge浏览器已经转向Blink； 
- Webkit：苹果基于KHTML开发、开源的，用于Safari。Google Chrome之前也在使用； 
- Blink：是Webkit的一个分支，Google开发。目前应用于Google Chrome、Edge、Opera；

### 5.标签的渲染过程

- HTML中的标签被HTML Parser解析成DOM Tree（标签被解析器解析成DOM树）
- 在上一个过程中可能会遇到js操作DOM树的情况（后面我们会引出js是怎么被执行的），那么遇到script标签就会停止解析HTML，去加载和执行js
- 以上两个过程共同生成了一个最终的DOM树

### 6.CSS的渲染过程

- Style Sheets（样式表）被CSS Parser解析成Style Rules（样式被CSS解析器解析成规则样式）

### 7.标签和CSS进行整合

- 通过Attachment引擎将Style Rules应用在DOM Tree上，进而生成Render Tree（渲染树）
- 在生成初步的一个Render Tree后，再由Layout布局引擎对渲染树根据不同的浏览器进行不同程度的布局
- 生成最终的渲染树（Render Tree）
- 最后通过painting（绘制引擎）把渲染树罗列在浏览器上进行展示

![image-20220105144507541](https://s2.loli.net/2022/02/09/HQDRTpoF6M7OVUg.png)

### 8.JavaScript引擎

- 将我们写的js代码转成机器语言（CPU指令），进而在CPU上执行

### 9.V8引擎的执行细节

![image-20211206100637658](https://s2.loli.net/2022/02/09/OQpdmbMyaDLCjW6.png)

那么我们的JavaScript源码是如何被解析（Parse过程）的呢？

- Blink将源码交给V8引擎，Stream获取到源码并且进行编码转换；
- Scanner会进行词法分析（lexical [ˈleksɪkl]  analysis），词法分析会将代码转换成tokens；
- 接下来tokens会被转换成AST树，经过Parser和PreParser：
  - Parser就是直接将tokens转成AST树结构；
  - PreParser称之为预解析，为什么需要预解析呢？
    - 这是因为并不是所有的JavaScript代码，在一开始时就会被执行。那么对所有的JavaScript代码进行解析，必然会影响网页的运行效率；
    - 所以V8引擎就实现了Lazy Parsing（延迟解析）的方案，它的作用是将不必要的函数进行预解析，也就是只解析暂时需要的内容，而对函数的全部解析是在函数被调用时才会进行；
    - 比如我们在一个函数outer内部定义了另外一个函数inner，那么inner函数就会进行预解析；

生成AST树后，会被Ignition转成字节码（bytecode），之后的过程就是代码的执行过程（后续会详细分析）。

```js
function foo() {
  function bar() {
    var name = "yt"
  }
}

foo()
```

- bar这个函数有没有必要做解析
- bar这个函数只会被预解析，可以理解为，程序知道有这么个bar函数就行，里面的东西一概不管