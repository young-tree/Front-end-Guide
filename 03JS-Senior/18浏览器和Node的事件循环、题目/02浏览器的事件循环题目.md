### 1.题目一

```js
setTimeout(function() {
  console.log("setTimeout1");

  new Promise(function(resolve) {
    resolve();
  }).then(function() {
    new Promise((resolve) => {
      resolve();
    }).then(() => {
      console.log("then4");
    });

    console.log("then2");
  });
});

new Promise(function(reslove) {
  console.log("promise1");
  reslove();
}).then(function() {
  console.log("then1");
});

setTimeout(function() {
  console.log("setTimeout2");
});

console.log(2);

queueMicrotask(function() {
  console.log("queueMicrotask1");
});

new Promise(function(resolve) {
  resolve();
}).then(function() {
  console.log("then3");
});

/*
promise1
2
then1
queueMicrotask1
then3
setTimeout1
then2
then4
setTimeout2
*/
```

### 2.async-await函数的执行顺序

```js
function bar() {
  console.log("222");
  new Promise((resolve) => {
    resolve("555");
  }).then(res => {
    console.log(res)
  });
}

async function foo() {
  console.log("111");
  await bar();
  console.log("333");
}

foo();
console.log("444");
```

```js
console.log("111");
await bar();
```

- 执行foo();
- console.log("111");和bar();属于同一个代码块，会被先执行，打印111
- await bar();下面的代码可以理解为放入then中的代码，会被加入到微任务队列中，但是现在还不能加，因为bar还没执行完
- 执行bar，打印222，将其中的Promise的then方法加入到微任务队列中
- 将await bar();下面的代码加入到微任务队列中
- 执行console.log("444");打印444
- 检查微任务队列中是否有回调，有，执行第一个then，555
- 再检查微任务队列中是否有回调，有，执行第二个then，333

- 注意Promise的then方法是加入到微任务队列中的，不是加入到宏任务队列中的，别和ajax搞混了, ajax的回调函数是被加入到宏任务队列中

### 3.题目二

```js
async function async1() {
  console.log("async1 start");
  await async2();
  console.log("async1 end");
}

async function async2() {
  console.log("async2");
}

console.log("script start");

setTimeout(function() {
  console.log("setTimeout");
}, 0);

async1();

new Promise((resolve) => {
  console.log("promise1");
  resolve();
}).then(res => {
  console.log("promise2");
});

console.log("script end");

/*
script start
async1 start
async2
promise1
script end
async1 end
promise2
setTimeout
*/

/*
微任务队列: 
	async1 end
	promise2
宏任务队列: 
	setTimeout
*/
```

### 4.题目三

```js
Promise.resolve().then(() => {
  console.log(0);
  return 4
}).then(res => {
  console.log(res);
});


Promise.resolve().then(() => {
  console.log(1);
}).then(() => {
  console.log(2);
}).then(() => {
  console.log(3);
}).then(() => {
  console.log(5);
}).then(() => {
  console.log(6);
});

/*
第一次往微任务队列中塞微任务
  console.log(0);
  return 4;
  console.log(1);
  return undefined;
*/

/*
0
1
*/

/*
第二次往微任务队列红塞微任务
	console.log(res);这个res就是return的4
	console.log(2);
*/

/*
4
2
*/

// 接下来就是再往微任务队列中塞微任务, 清空微任务队列的重复操作了

// 答案是
/*
0
1
4
2
3
5
6
*/
```

```js
Promise.resolve().then(() => {
  console.log(0);
  return {
    then: function(resolve) {
      resolve(4)
    }
  }
}).then(res => {
  console.log(res);
});


Promise.resolve().then(() => {
  console.log(1);
}).then(() => {
  console.log(2);
}).then(() => {
  console.log(3);
}).then(() => {
  console.log(5);
}).then(() => {
  console.log(6);
});
// 推迟1次
// 答案是
/*
0
1
2
4
3
5
6
*/

Promise.resolve().then(() => {
  console.log(0);
  return Promise.resolve(4);
}).then(res => {
  console.log(res);
});


Promise.resolve().then(() => {
  console.log(1);
}).then(() => {
  console.log(2);
}).then(() => {
  console.log(3);
}).then(() => {
  console.log(5);
}).then(() => {
  console.log(6);
});
// 推迟两次
// 答案是
/*
0
1
2
3
4
5
6
*/
```

