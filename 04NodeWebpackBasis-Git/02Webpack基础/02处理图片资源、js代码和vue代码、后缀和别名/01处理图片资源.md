### 1.知识储备

- 我们当前使用的webpack版本是webpack5
  - 在webpack5之前，加载资源我们需要使用一些loader
    - raw-loader、url-loader、file-loader
  - 从webpack5开始，可以直接使用资源模块类型（asset module type），来替代上面的loader
- 资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些loader
  - asset/resource 发送一个单独的文件并导出 URL
    - 之前通过使用 file-loader 实现
    - 打包时在打包后的文件中拷贝使用的图片，请求页面时，需要对这个图片进行网络请求
    - 这种方式不推荐应用于众多图片的打包，会影响用户的带宽
  - asset/inline 导出一个资源的 data URI
    - 之前通过使用 url-loader 实现
    - 打包时，把图片编码成base64，内嵌到打包后的js文件中
    - 这种方式会让js文件变得过于臃肿，所以一般用于小图片
  - asset/source 导出资源的源代码
    - 之前通过使用 raw-loader 实现
    - 不常用
  - asset 在导出一个 data URI 和发送一个单独的文件之间自动选择
    - 之前通过使用 url-loader，并且配置资源体积限制实现
    - 它可以判断图片的大小，在resource和inline中做出选择
    - 除此之外我们可以指定选择的界限

### 2.加载图片代码编写

- src/man.js

  ```js
  import "./css/div-style.css";
  
  // 1.填写大图
  const img1 = require("./img/07_3_phases.png");
  const imgEl = document.createElement("img");
  imgEl.src = img1;
  document.body.append(imgEl);
  
  // 2.填写小图
  const divEl = document.createElement("div");
  divEl.classList.add("addBackImg");
  document.body.append(divEl);
  ```

- src/css/div-style.css

  ```css
  .addBackImg {
    width: 100px;
    height: 100px;
    background: url(../img/doubantime.jpg);
  }
  ```

- wk.config.js

  ```js
  module.exports = {
    module: {
      rules: [
        {
          test: /\.css$/ig,
          use: ["style-loader", "css-loader"]
        },
        {
          test: /\.(png||jpe?g||gif||svg)$/ig,
          type: "asset"
        }
      ]
    }
  }
  ```

### 3.文件的输出路径和文件名

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png||jpe?g||gif||svg)$/ig,
        type: "asset",
        generator: {
          filename: "img/[name].[hash:6][ext]"
        }
      }
    ]
  }
}
```

- `img/[name].[hash:6][ext]`
  - 在img目录下打包
  - 自己的名字和六位的哈希值，中间以点进行分割
  - 最后加上扩展名，扩展名包括点
- 当然你也可以在output中指定，但是不推荐，容易引起冲突，这里不再给出相应代码
- 这里的正则可以写一个竖线表示或，也可以写两个竖线表示或
  - 正规一点的话写一个线

### 4.指定limit

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png||jpe?g||gif||svg)$/ig,
        type: "asset",
        generator: {
          filename: "img/[name].[hash:6][ext]"
        },
        parser: {
          dataUrlCondition: {
            maxSize: 100 * 1024
          }
        }
      }
    ]
  }
}
```

- 100 * 1024
  - 这里的1024表示1kb
  - 所以100 * 1024就表示100kb
- 这里的两张图片大小分别是1000kb和5kb
  - 所以1000kb直接打包用url来访问
  - 5kb的就直接编码成base64内嵌到js代码中