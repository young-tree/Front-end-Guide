### 1.封装

```js
class YTRequest {
  constructor(baseURL) { this.baseURL = baseURL }

  request(options) {
    return new Promise(resolve => {
      wx.request({
        ...options,
        url: this.baseURL + options.url,
        success: res => resolve(res.data)
      })
    })
  }
  get(options) { return this.request(options) }
  post(options) { return this.request({...options, method: "post"}) }
}

export const normalRequest = new YTRequest("http://codercba.com:1888/api")
export const loginRequest = new YTRequest("http://123.207.32.32:3000")
```

### 2.使用

```js
import { normalRequest } from "../../service/index"

Page({
  async onLoad() {
    const houselist = await normalRequest.request({
      url: "/home/houselist",
      data: { page: 1 }
    })
    const city = await normalRequest.get({url: "/city/all"})
  }
})
```

- 问题是只有houselist获取到结果后才会执行后面的代码
- 在houselist获得结果之前, city这里的代码就不能执行, 无法发起请求, 影响效率

### 3.解决

```js
import { normalRequest } from "../../service/index"

Page({
  async onLoad() {
    this.getHouselist()
    this.getCity()
  },

  async getHouselist() {
    const houselist = await normalRequest.request({
      url: "/home/houselist",
      data: { page: 1 }
    })
    this.setData({houselist})
  },
  async getCity() {
    const city = await normalRequest.get({url: "/city/all"})
    this.setData({city})
  }
})
```

