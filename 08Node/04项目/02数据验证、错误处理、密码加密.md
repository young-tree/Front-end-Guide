### 1.验证客户端传递过来的数据

- user.controller.ts，在中间件中进行判断：<img src="images/image-20221120204704859.png" alt="image-20221120204704859" style="zoom:50%;" />
- user.service.ts，执行sql语句：<img src="images/image-20221120204841937.png" alt="image-20221120204841937" style="zoom:50%;" />
- 代码重构，将user.controller.ts中的验证逻辑抽取到user.router.ts，就是多加了一个中间件，这个中间件都通过了，就会执行next函数，才会开始执行下一个中间件：<img src="images/image-20221120205511626.png" alt="image-20221120205511626" style="zoom:50%;" />
  - 但是这样做也是很复杂的，所以还需要抽取

### 2.验证中间件的代码抽取

- 目录结构：<img src="images/image-20221120210204993.png" alt="image-20221120210204993" style="zoom:50%;" />，user.middleware.ts：<img src="images/image-20221120210241389.png" alt="image-20221120210241389" style="zoom:50%;" />
- user.router.ts，应用中间件：<img src="images/image-20221120210314024.png" alt="image-20221120210314024" style="zoom:50%;" />

### 3.错误处理代码抽取

- 目录结构：<img src="images/image-20221120211848668.png" alt="image-20221120211848668" style="zoom:50%;" />，utils/handle.error.ts：<img src="images/image-20221120211930223.png" alt="image-20221120211930223" style="zoom:50%;" />
- main.ts，使处理错误的文件生效：<img src="images/image-20221120212000765.png" alt="image-20221120212000765" style="zoom:50%;" />
- user.middleware.ts重构代码，发射error事件：<img src="images/image-20221120212137167.png" alt="image-20221120212137167" style="zoom:50%;" />


### 4.常量抽取

- 目录结构：<img src="images/image-20221120220253332.png" alt="image-20221120220253332" style="zoom:50%;" />

- config/error.ts：<img src="images/image-20221120215531463.png" alt="image-20221120215531463" style="zoom:50%;" />

- utils/handle.error.ts：<img src="images/image-20221120215649485.png" alt="image-20221120215649485" style="zoom:50%;" />
- user.middleware.ts：<img src="images/image-20221120215718705.png" alt="image-20221120215718705" style="zoom:50%;" />

### 5.密码加密

- 对用户传递过来的密码进行加密，目录结构：<img src="images/image-20221120223001587.png" alt="image-20221120223001587" style="zoom: 50%;" />
- md5-password.ts，通过md5进行加密：<img src="images/image-20221120223048818.png" alt="image-20221120223048818" style="zoom:50%;" />



- user.middleware.ts，加密传递过来的密码：<img src="images/image-20221120223153131.png" alt="image-20221120223153131" style="zoom:50%;" />
- user.router.ts，应用中间件：<img src="images/image-20221120223259952.png" alt="image-20221120223259952" style="zoom:50%;" />

- 效果：<img src="images/image-20221120223804388.png" alt="image-20221120223804388" style="zoom:50%;" />