```js
class Depend {
  constructor() { this.objFn = new Set() }

  depend() {
    if (reactiveFn) { this.objFn.add(reactiveFn) }
  }
  notify() { this.objFn.forEach(item => item()) }
}

let reactiveFn = null
function watchFn(fn) {
  reactiveFn = fn
  fn()
  reactiveFn = null
}

const weakMap = new WeakMap()
const getDepend = (obj, key) => {
  let map = weakMap.get(obj)
  if(!map) {
    map = new Map()
    weakMap.set(obj, map)
  }

  let dep = map.get(key)
  if(!dep) {
    dep = new Depend()
    map.set(key, dep)
  }

  return dep
}

function reactive(obj) {
  return new Proxy(obj, {
    set(target, key, value, receiver) {
      Reflect.set(target, key, value, receiver)
      const dep = getDepend(target, key)
      dep.notify()
    },
    get(target, key, receiver) {
      const dep = getDepend(target, key)
      dep.depend()
      return Reflect.get(target, key, receiver)
    }
  })
}

const obj1 = reactive({ name: "yt", age: 22 })
const obj2 = reactive({ name: "yt", age: 22 })

const fn1 = () => console.log(obj1.name)
watchFn(fn1)
const fn2 = () => console.log(obj1.name, "哈哈哈哈")
watchFn(fn2)
const fn3 = () => console.log(obj1.name, "哈哈哈哈", obj1.age, obj1.age)
watchFn(fn3)

const fn4 = () => console.log(obj2.name)
watchFn(fn4)
const fn5 = () => console.log(obj2.name, "哈哈哈哈")
watchFn(fn5)
const fn6 = () => console.log(obj2.name, "哈哈哈哈", obj2.age, obj2.age)
watchFn(fn6)

obj1.name = "why"
obj1.age = 18

obj2.name = "aaa"
obj2.age = 28
```

```js
// 区别
function reactive(obj) {
  Object.keys(obj).forEach(key => {
    let value = obj[key]
    Object.defineProperty(obj, key, {
      set(newVal) {
        value = newVal
        const dep = getDepend(obj, key)
        dep.notify()
      },
      get() {
        const dep = getDepend(obj, key)
        dep.depend()
        return value
      }
    })
  })

  return obj
}
```

